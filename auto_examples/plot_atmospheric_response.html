

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Time ranges and the atmospheric response &mdash; response-tools 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="/home/runner/work/response-tools/response-tools/docs/styles/svg_width_style.css?v=4fc4a161" />

  
    <link rel="shortcut icon" href="../_static/Glyph_FOXSI4_favicon.png"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Response-tools Code ü¶ä" href="../code.html" />
    <link rel="prev" title="Create an ARF from scratch" href="plot_arf_from_scratch.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            response-tools
              <img src="../_static/Glyph_FOXSI4_text.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../instrument.html">FOXSI-4 Instrumentation ü¶ä</a></li>
<li class="toctree-l1"><a class="reference internal" href="../observation.html">FOXSI-4 Observation <span>ü¶ä</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../response_guide.html">What Is a Response? <span>ü¶ä</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="../general_instructions.html">Response-tools for FOXSI-4 <span>ü¶ä</span></a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Response-tools Examples ü¶ä</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#data-handling-examples">Data handling examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#plotting-examples">Plotting examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#whole-example-gallery">Whole example gallery</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plot_telescope_arfs_rmfs_srms.html">Telescope ARFs, RMFs, and SRMs</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_functions_and_outputs.html">Functions &amp; Outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="telescope_summary.html">Telescope Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_rmf_examples.html">Example FOXSI-4 RMFs</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_arf_rmf_srm.html">Generating and plotting ARFs, RMFs, and SRMs</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_arf_from_scratch.html">Create an ARF from scratch</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Time ranges and the atmospheric response</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-function-documentation">The function documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-the-function">Using the function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#atmospheric-transmission-time-profile">Atmospheric transmission time profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#atmospheric-transmission-for-a-time-range">Atmospheric transmission for a time range</a></li>
<li class="toctree-l4"><a class="reference internal" href="#atmospheric-transmission-with-different-energy-resolutions">Atmospheric transmission with different energy resolutions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../code.html">Response-tools Code ü¶ä</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions_and_releases.html">Versions and Releases <span>ü¶ä</span></a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">response-tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Response-tools Examples ü¶ä</a></li>
      <li class="breadcrumb-item active">Time ranges and the atmospheric response</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/auto_examples/plot_atmospheric_response.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-plot-atmospheric-response-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="time-ranges-and-the-atmospheric-response">
<span id="sphx-glr-auto-examples-plot-atmospheric-response-py"></span><h1>Time ranges and the atmospheric response<a class="headerlink" href="#time-ranges-and-the-atmospheric-response" title="Link to this heading">ÔÉÅ</a></h1>
<p>Script showing how a user might want to consider choosing their analysis
time range in relation to the atmospheric response.</p>
<p>Check out the <a class="reference external" href="https://foxsi.github.io/response-tools/observation.html#choosing-a-time-range">Choosing a time range</a>
section in the online documentation for more details on other
observational time range factors to consider.</p>
<p>Throughout FOXSI-4‚Äôs flight, there are different amounts of atmosphere
in the line of sight that will attenuate the incoming X-rays. This
example will show how to get to the atmopspheric response values.</p>
<p>The example originally followed the plot produced from
<code class="docutils literal notranslate"><span class="pre">response_tools.attenuation.asset_atm()</span></code>.</p>
<p><em>Note:</em> The atmospheric response is included in the level 3 ARF response
functions that have ‚Äúflight‚Äù in their name. E.g,
<code class="docutils literal notranslate"><span class="pre">response_tools.responses.foxsi4_telescope0_flight_arf</span></code> which will
require a <code class="docutils literal notranslate"><span class="pre">time_range</span></code> input to work.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">time_support</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">matplotlib.dates</span> <span class="kn">import</span> <span class="n">DateFormatter</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">response_tools.attenuation</span> <span class="kn">import</span> <span class="n">att_foxsi4_atmosphere</span>

<span class="n">time_support</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;astropy.visualization.time.time_support.&lt;locals&gt;.MplTimeConverter object at 0x7fa27901c770&gt;
</pre></div>
</div>
<section id="the-function-documentation">
<h2>The function documentation<a class="headerlink" href="#the-function-documentation" title="Link to this heading">ÔÉÅ</a></h2>
<p>The documentation for any function in <code class="docutils literal notranslate"><span class="pre">response-tools</span></code> can be found
online <a class="reference external" href="https://foxsi.github.io/response-tools/modules.html">here</a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">response_tools.attenuation.att_foxsi4_atmosphere</span></code> documentation
can be found <a class="reference external" href="https://foxsi.github.io/response-tools/response_tools.html#response_tools.attenuation.att_foxsi4_atmosphere">here</a>,
but we can also use the <code class="docutils literal notranslate"><span class="pre">help</span></code> function.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">att_foxsi4_atmosphere</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Help on function att_foxsi4_atmosphere in module response_tools.attenuation:

att_foxsi4_atmosphere(mid_energies, time_range=None, file=None)
    Atmsopheric attenuation from and for FOXSI-4 flight data.

    Parameters
    ----------
    mid_energies : `astropy.units.quantity.Quantity`
        The energies at which the transmission is required. If
        `numpy.nan&lt;&lt;astropy.units.keV` is passed then an entry for all
        native file energies are returned.
        Unit must be convertable to keV.

    time_range : `astropy.units.quantity.Quantity` or `None`
        The time range the atmsopheric transmissions should be averaged
        over. If `None`, `numpy.nan&lt;&lt;astropy.units.second`, or
        `[numpy.nan, numpy.nan]&lt;&lt;astropy.units.second` then the full
        time will be considered and the output will not be averaged but
        a grid of the transmissions at all times and at any provided
        energies. Should be of length 2. Can be given as seconds since
        launch or as UTC time as well either as a string or and Astropy
        time.
        - Observation start: 100&lt;&lt;astropy.units.second
        - Observation end: 461&lt;&lt;astropy.units.second
        - String format: YYYY-mm-ddTHH:MM:SS
        - Observation start: 2024-04-17T22:14:40
        - Observation end: 2024-04-17T22:20:41

    file : `str` or `None`
        Path/name of a custom file wanting to be loaded in as the
        atmospheric data file.

    Returns
    -------
    : `AttOutput`
        An object containing the energies for each transmission, the
        transmissions, and more. See accessible information using
        `.contents` on the output.

    Example
    -------
    &gt;&gt;&gt; from astropy.time import Time
    &gt;&gt;&gt; import astropy.units as u
    # two equivalent calls to the function
    # using Astorpy times
    &gt;&gt;&gt; a0 = att_foxsi4_atmosphere([np.nan]&lt;&lt;u.keV,
                                   time_range=Time([&quot;2024-04-17T22:14:40&quot;,
                                                    &quot;2024-04-17T22:20:41&quot;],
                                                   format=&#39;isot&#39;,
                                                   scale=&#39;utc&#39;))
    # using seconds from launch values (unit-aware)
    &gt;&gt;&gt; a1 = att_foxsi4_atmosphere([np.nan]&lt;&lt;u.keV,
                                   time_range=[100,
                                               461]&lt;&lt;u.second)
</pre></div>
</div>
</section>
<section id="using-the-function">
<h2>Using the function<a class="headerlink" href="#using-the-function" title="Link to this heading">ÔÉÅ</a></h2>
<p>Here it is seen the function would like energies and a time range. A
user can also see there are some helpful time markers like the observation
start (shutter door open) and observation end (shutter door closed).
Notice these times are slightly early and late of the first and last
time interval shown in the <a class="reference external" href="https://foxsi.github.io/response-tools/observation.html#choosing-a-time-range">Choosing a time range</a>
table, respectively.</p>
<p>Before getting into time ranges, a user might want to only sample one
energy, or several, and inspect the time profile of the attenuation.</p>
<p>To get all times back from the function, specific times don‚Äôt need to
known. The function will return all times if <code class="docutils literal notranslate"><span class="pre">numpy.nan</span></code> is passed
(but it still needs to be unit-aware).</p>
<p>So let‚Äôs get the atmsopheric transmission at 1 keV for the full
flight:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">energy0</span><span class="p">,</span> <span class="n">time0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="o">&lt;&lt;</span><span class="n">u</span><span class="o">.</span><span class="n">second</span>
<span class="n">atm0</span> <span class="o">=</span> <span class="n">att_foxsi4_atmosphere</span><span class="p">(</span><span class="n">mid_energies</span><span class="o">=</span><span class="n">energy0</span><span class="p">,</span>
                             <span class="n">time_range</span><span class="o">=</span><span class="n">time0</span><span class="p">)</span>
</pre></div>
</div>
<p>Now <code class="docutils literal notranslate"><span class="pre">atm0</span></code> stores the transmission time rpofile for 1 keV photons.</p>
<p>A user might want to inspect the time profile for several energies. To
do this, an energy array can be passed which will return a matrix in
the <code class="docutils literal notranslate"><span class="pre">transmission</span></code> attribute where the rows are times and the
columns are the different energy transmissions.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">energy1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span>
<span class="n">atm1</span> <span class="o">=</span> <span class="n">att_foxsi4_atmosphere</span><span class="p">(</span><span class="n">mid_energies</span><span class="o">=</span><span class="n">energy1</span><span class="p">,</span>
                             <span class="n">time_range</span><span class="o">=</span><span class="n">time0</span><span class="p">)</span>
</pre></div>
</div>
<p>A user will likely want to select times out of the time profile, so
let‚Äôs start defining some times in which a user might be interested.
Say, the time range spanning the whole observation time:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># in seconds since launch</span>
<span class="n">obs_start2end_sec</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">461</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">u</span><span class="o">.</span><span class="n">second</span>
<span class="c1"># in UTC</span>
<span class="n">obs_start2end_utc</span> <span class="o">=</span> <span class="n">Time</span><span class="p">([</span><span class="s2">&quot;2024-04-17T22:14:40&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;2024-04-17T22:20:41&quot;</span><span class="p">],</span>
                         <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;isot&#39;</span><span class="p">,</span>
                         <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;utc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="atmospheric-transmission-time-profile">
<h2>Atmospheric transmission time profile<a class="headerlink" href="#atmospheric-transmission-time-profile" title="Link to this heading">ÔÉÅ</a></h2>
<p>This information can be visualised (although plotting code always
looks messy):</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">gs_ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="c1"># transmissions from only passing one energy</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">gs_ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm0</span><span class="o">.</span><span class="n">times_utc</span><span class="p">,</span>
                 <span class="n">atm0</span><span class="o">.</span><span class="n">transmissions</span><span class="p">,</span>
                 <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;energy:</span><span class="si">{</span><span class="n">energy0</span><span class="si">:</span><span class="s2">latex</span><span class="si">}</span><span class="se">\n</span><span class="s2">time:</span><span class="si">{</span><span class="n">time0</span><span class="si">:</span><span class="s2">latex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                 <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># plot the different energy transmission time profiles</span>
<span class="n">p1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energy1</span><span class="p">)):</span>
    <span class="n">p1</span> <span class="o">+=</span> <span class="n">gs_ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm1</span><span class="o">.</span><span class="n">times_utc</span><span class="p">,</span>
                      <span class="n">atm1</span><span class="o">.</span><span class="n">transmissions</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span>
                      <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;energy:</span><span class="si">{</span><span class="n">energy1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">latex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># label bookkeeping</span>
<span class="n">gs_ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transmission [</span><span class="si">{</span><span class="n">atm0</span><span class="o">.</span><span class="n">transmissions</span><span class="o">.</span><span class="n">unit</span><span class="si">:</span><span class="s2">latex</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<span class="n">gs_ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UTC Time (Obs. start~</span><span class="si">{</span><span class="n">obs_start2end_utc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">gs_ax0</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.05</span><span class="p">])</span>
<span class="n">gs_ax0</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">atm1</span><span class="o">.</span><span class="n">times_utc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atm1</span><span class="o">.</span><span class="n">times_utc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">gs_ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Sampled energy band transmission vs. time&quot;</span><span class="p">)</span>
<span class="n">gs_ax0</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">))</span>
<span class="c1"># would like to display seconds since launch along the top of the plot</span>
<span class="n">gs_ax0b</span> <span class="o">=</span> <span class="n">gs_ax0</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
<span class="n">gs_ax0b_color</span> <span class="o">=</span> <span class="s2">&quot;grey&quot;</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">gs_ax0b</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm0</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">atm0</span><span class="o">.</span><span class="n">transmissions</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">gs_ax0b</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">obs_start2end_sec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;obs. start&quot;</span><span class="p">)</span>
<span class="n">v2</span> <span class="o">=</span> <span class="n">gs_ax0b</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">obs_start2end_sec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;obs. end&quot;</span><span class="p">)</span>
<span class="n">gs_ax0b</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time (Obs. start~100 s) [</span><span class="si">{</span><span class="n">atm0</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">unit</span><span class="si">:</span><span class="s2">latex</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">gs_ax0b_color</span><span class="p">)</span>
<span class="n">gs_ax0b</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">atm1</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">atm1</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
<span class="n">gs_ax0b</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">gs_ax0b_color</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">gs_ax0b_color</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
<span class="c1"># let&#39;s put the timestamps on the plot</span>
<span class="n">_y_time_loc</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">_x_offset</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">&lt;&lt;</span> <span class="n">u</span><span class="o">.</span><span class="n">second</span>
<span class="n">gs_ax0</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obs_start2end_utc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> UTC&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">obs_start2end_utc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">_x_offset</span><span class="p">,</span> <span class="n">_y_time_loc</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">gs_ax0</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obs_start2end_utc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> UTC&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">obs_start2end_utc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_y_time_loc</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
<span class="n">_y_sec_loc</span> <span class="o">=</span> <span class="n">_y_time_loc</span><span class="o">+</span><span class="mf">0.25</span>
<span class="n">gs_ax0b</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obs_start2end_sec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">obs_start2end_sec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">+</span><span class="n">_x_offset</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_y_sec_loc</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">gs_ax0b_color</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">gs_ax0b</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obs_start2end_sec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">obs_start2end_sec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_y_sec_loc</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">gs_ax0b_color</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
<span class="c1"># make sure to show the legend</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">p0</span><span class="o">+</span><span class="n">p1</span><span class="o">+</span><span class="p">[</span><span class="n">v0</span><span class="p">,</span><span class="n">v2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_atmospheric_response_001.png" srcset="../_images/sphx_glr_plot_atmospheric_response_001.png" alt="Sampled energy band transmission vs. time" class = "sphx-glr-single-img"/></section>
<section id="atmospheric-transmission-for-a-time-range">
<h2>Atmospheric transmission for a time range<a class="headerlink" href="#atmospheric-transmission-for-a-time-range" title="Link to this heading">ÔÉÅ</a></h2>
<p>A user can decide they do not care about the energy range for the
transmission. (Note: this should be decided by the
<a class="reference external" href="https://foxsi.github.io/response-tools/response_guide.html#what-is-a-redistribution-matrix-function-file-rmf">RMF</a>.)</p>
<p>Similar to what was seen for the <code class="docutils literal notranslate"><span class="pre">time_range</span></code> input, <code class="docutils literal notranslate"><span class="pre">numpy.nan</span></code>
can be passed (unit-aware). Let‚Äôs average over the whole time range:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">energy2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="o">&lt;&lt;</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span>
<span class="n">atm2</span> <span class="o">=</span> <span class="n">att_foxsi4_atmosphere</span><span class="p">(</span><span class="n">mid_energies</span><span class="o">=</span><span class="n">energy2</span><span class="p">,</span>
                             <span class="n">time_range</span><span class="o">=</span><span class="n">obs_start2end_sec</span><span class="p">)</span>
</pre></div>
</div>
<p>Since the <code class="docutils literal notranslate"><span class="pre">time_range</span></code> can be given as seconds since launch and in
Astropy UTC, the following code is equivalent to the above for
<code class="docutils literal notranslate"><span class="pre">atm2</span></code>:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">atm2a</span> <span class="o">=</span> <span class="n">att_foxsi4_atmosphere</span><span class="p">(</span><span class="n">mid_energies</span><span class="o">=</span><span class="n">energy2</span><span class="p">,</span>
                              <span class="n">time_range</span><span class="o">=</span><span class="n">obs_start2end_utc</span><span class="p">)</span>
</pre></div>
</div>
<p>A user can also just return all transmissions at all energies and
times from the original file containing the data:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">energy3</span><span class="p">,</span> <span class="n">time3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="o">&lt;&lt;</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="o">&lt;&lt;</span><span class="n">u</span><span class="o">.</span><span class="n">second</span>
<span class="n">atm3</span> <span class="o">=</span> <span class="n">att_foxsi4_atmosphere</span><span class="p">(</span><span class="n">mid_energies</span><span class="o">=</span><span class="n">energy3</span><span class="p">,</span>
                             <span class="n">time_range</span><span class="o">=</span><span class="n">time3</span><span class="p">)</span>
</pre></div>
</div>
<p>This can be plotted of course to get a better idea of what is going
on.</p>
<p>Let‚Äôs plot the averaged transmissions over the whole observation at
the native file energy resolution (<code class="docutils literal notranslate"><span class="pre">atm2</span></code>) and then let‚Äôs use
<code class="docutils literal notranslate"><span class="pre">atm3</span></code> to sample some transmission curves at some ‚Äúrandom‚Äù
instantaneous times by indexing.</p>
<p>Let‚Äôs mark where the CdTe and CMOS detector telescope energies ranges
lie on the plot for more context.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">gs_ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="c1"># whole time range average</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">gs_ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm2</span><span class="o">.</span><span class="n">mid_energies</span><span class="p">,</span>
                 <span class="n">atm2</span><span class="o">.</span><span class="n">transmissions</span><span class="p">,</span>
                 <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                 <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;time range:</span><span class="si">{</span><span class="n">obs_start2end_sec</span><span class="si">:</span><span class="s2">latex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">p2a</span> <span class="o">=</span> <span class="n">gs_ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm2a</span><span class="o">.</span><span class="n">mid_energies</span><span class="p">,</span>
                  <span class="n">atm2a</span><span class="o">.</span><span class="n">transmissions</span><span class="p">,</span>
                  <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span>
                  <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;time range:</span><span class="si">{</span><span class="n">obs_start2end_utc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># random instantaneous times</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">gs_ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm3</span><span class="o">.</span><span class="n">mid_energies</span><span class="p">,</span>
                 <span class="n">atm3</span><span class="o">.</span><span class="n">transmissions</span><span class="p">[:,</span> <span class="mi">2000</span><span class="p">],</span>
                 <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;time:</span><span class="si">{</span><span class="n">atm3</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="mi">2000</span><span class="p">]</span><span class="si">:</span><span class="s2">latex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">p4</span> <span class="o">=</span> <span class="n">gs_ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm3</span><span class="o">.</span><span class="n">mid_energies</span><span class="p">,</span>
                 <span class="n">atm3</span><span class="o">.</span><span class="n">transmissions</span><span class="p">[:,</span> <span class="mi">5600</span><span class="p">],</span>
                 <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;time:</span><span class="si">{</span><span class="n">atm3</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="mi">5600</span><span class="p">]</span><span class="si">:</span><span class="s2">latex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">p5</span> <span class="o">=</span> <span class="n">gs_ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm3</span><span class="o">.</span><span class="n">mid_energies</span><span class="p">,</span>
                 <span class="n">atm3</span><span class="o">.</span><span class="n">transmissions</span><span class="p">[:,</span> <span class="mi">9200</span><span class="p">],</span>
                 <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;time:</span><span class="si">{</span><span class="n">atm3</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="mi">9200</span><span class="p">]</span><span class="si">:</span><span class="s2">latex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># let&#39;s show the CdTe and CMOS energies on this plot for conntext</span>
<span class="n">cmos_le</span> <span class="o">=</span> <span class="mf">0.8</span><span class="o">&lt;&lt;</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span>
<span class="n">v3</span> <span class="o">=</span> <span class="n">gs_ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">cmos_le</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CMOS energies&quot;</span><span class="p">)</span>
<span class="n">gs_ax1</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">cmos_le</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">cdte_le</span> <span class="o">=</span> <span class="mi">4</span><span class="o">&lt;&lt;</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span>
<span class="n">v4</span> <span class="o">=</span> <span class="n">gs_ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">cdte_le</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CdTe energies&quot;</span><span class="p">)</span>
<span class="n">gs_ax1</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">cdte_le</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="c1"># some label bookkeeping</span>
<span class="n">gs_ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transmission [</span><span class="si">{</span><span class="n">atm3</span><span class="o">.</span><span class="n">transmissions</span><span class="o">.</span><span class="n">unit</span><span class="si">:</span><span class="s2">latex</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<span class="n">gs_ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Energy [</span><span class="si">{</span><span class="n">atm3</span><span class="o">.</span><span class="n">mid_energies</span><span class="o">.</span><span class="n">unit</span><span class="si">:</span><span class="s2">latex</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<span class="n">gs_ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.05</span><span class="p">])</span>
<span class="n">gs_ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">30</span><span class="p">])</span>
<span class="n">gs_ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">gs_ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Time averaged and time sampled transmission vs. energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">p2</span><span class="o">+</span><span class="n">p2a</span><span class="o">+</span><span class="n">p3</span><span class="o">+</span><span class="n">p4</span><span class="o">+</span><span class="n">p5</span><span class="o">+</span><span class="p">[</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_atmospheric_response_002.png" srcset="../_images/sphx_glr_plot_atmospheric_response_002.png" alt="Time averaged and time sampled transmission vs. energy" class = "sphx-glr-single-img"/></section>
<section id="atmospheric-transmission-with-different-energy-resolutions">
<h2>Atmospheric transmission with different energy resolutions<a class="headerlink" href="#atmospheric-transmission-with-different-energy-resolutions" title="Link to this heading">ÔÉÅ</a></h2>
<p>From the above plot, the user can see quite a bit of detail in the
time profiles but a user will likely wish to match the energy
resolution to that of the relevant telescope RMF.</p>
<p>So, let‚Äôs show the full observation time curve with different energy
resolutions:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># some random energies</span>
<span class="n">energy4</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span>
<span class="n">atm4</span> <span class="o">=</span> <span class="n">att_foxsi4_atmosphere</span><span class="p">(</span><span class="n">mid_energies</span><span class="o">=</span><span class="n">energy4</span><span class="p">,</span>
                             <span class="n">time_range</span><span class="o">=</span><span class="n">obs_start2end_sec</span><span class="p">)</span>
</pre></div>
</div>
<p>Let‚Äôs also consider the CdTe RMF energy resolution:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">energy5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mf">30.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span>
<span class="n">atm5</span> <span class="o">=</span> <span class="n">att_foxsi4_atmosphere</span><span class="p">(</span><span class="n">mid_energies</span><span class="o">=</span><span class="n">energy5</span><span class="p">,</span>
                             <span class="n">time_range</span><span class="o">=</span><span class="n">obs_start2end_sec</span><span class="p">)</span>
</pre></div>
</div>
<p>Let‚Äôs plot this to see how it looks:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">gs_ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="c1"># random energy resolution</span>
<span class="n">colour4</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
<span class="n">p6</span> <span class="o">=</span> <span class="n">gs_ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm4</span><span class="o">.</span><span class="n">mid_energies</span><span class="p">,</span>
                 <span class="n">atm4</span><span class="o">.</span><span class="n">transmissions</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;time range:</span><span class="si">{</span><span class="n">atm4</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">$-$</span><span class="si">{</span><span class="n">atm4</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">random-ish energy sampling&quot;</span><span class="p">,</span>
                 <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
                 <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                 <span class="n">c</span><span class="o">=</span><span class="n">colour4</span><span class="p">)</span>
<span class="c1"># CdTe energy resolution</span>
<span class="n">colour5</span> <span class="o">=</span> <span class="s2">&quot;orange&quot;</span>
<span class="n">gs_ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm5</span><span class="o">.</span><span class="n">mid_energies</span><span class="p">,</span>
            <span class="n">atm5</span><span class="o">.</span><span class="n">transmissions</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;time range:</span><span class="si">{</span><span class="n">atm5</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">$-$</span><span class="si">{</span><span class="n">atm5</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">CdTe range+response resolution&quot;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
            <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="n">colour5</span><span class="p">)</span>

<span class="c1"># add the lowest energies of the detectors</span>
<span class="n">v5</span> <span class="o">=</span> <span class="n">gs_ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">cmos_le</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CMOS energies&quot;</span><span class="p">)</span>
<span class="n">gs_ax2</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">cmos_le</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">v6</span> <span class="o">=</span> <span class="n">gs_ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">cdte_le</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CdTe energies&quot;</span><span class="p">)</span>
<span class="n">gs_ax2</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">cdte_le</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

<span class="c1"># inset Axes for the CdTe plot</span>
<span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">1.04</span>  <span class="c1"># subregion of the original image</span>
<span class="n">axins</span> <span class="o">=</span> <span class="n">gs_ax2</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span>
                            <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span>
                            <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span> <span class="c1">#, xticklabels=[], yticklabels=[])</span>
<span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm4</span><span class="o">.</span><span class="n">mid_energies</span><span class="p">,</span> <span class="n">atm4</span><span class="o">.</span><span class="n">transmissions</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;time range:</span><span class="si">{</span><span class="n">atm4</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">$-$</span><span class="si">{</span><span class="n">atm4</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">random-ish energy sampling&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colour4</span><span class="p">)</span>
<span class="n">p7</span> <span class="o">=</span> <span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">atm5</span><span class="o">.</span><span class="n">mid_energies</span><span class="p">,</span> <span class="n">atm5</span><span class="o">.</span><span class="n">transmissions</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;time range:</span><span class="si">{</span><span class="n">atm5</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">$-$</span><span class="si">{</span><span class="n">atm5</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">CdTe range+response resolution&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colour5</span><span class="p">)</span>
<span class="n">axins</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">_rectangle</span><span class="p">,</span> <span class="n">_connectors</span> <span class="o">=</span> <span class="n">gs_ax2</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="c1"># edit the connecting lines so they make sense</span>
<span class="n">_connectors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">_connectors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># add the lowest energies of the detectors to the inset plot</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axins</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">cmos_le</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CMOS energies&quot;</span><span class="p">)</span>
<span class="n">axins</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">cmos_le</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mf">0.96</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axins</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">cdte_le</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CdTe energies&quot;</span><span class="p">)</span>
<span class="n">axins</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">cdte_le</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mf">0.96</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

<span class="c1"># some label bookkeeping</span>
<span class="n">gs_ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transmission [</span><span class="si">{</span><span class="n">atm3</span><span class="o">.</span><span class="n">transmissions</span><span class="o">.</span><span class="n">unit</span><span class="si">:</span><span class="s2">latex</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<span class="n">gs_ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Energy [</span><span class="si">{</span><span class="n">atm3</span><span class="o">.</span><span class="n">mid_energies</span><span class="o">.</span><span class="n">unit</span><span class="si">:</span><span class="s2">latex</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<span class="n">gs_ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.05</span><span class="p">])</span>
<span class="n">gs_ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">30</span><span class="p">])</span>
<span class="n">gs_ax2</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">gs_ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Time averaged transmission vs. sampled energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">p6</span><span class="o">+</span><span class="n">p7</span><span class="o">+</span><span class="p">[</span><span class="n">v5</span><span class="p">,</span><span class="n">v6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_atmospheric_response_003.png" srcset="../_images/sphx_glr_plot_atmospheric_response_003.png" alt="Time averaged transmission vs. sampled energy" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/home/runner/work/response-tools/response-tools/examples/plot_atmospheric_response.py:300: MatplotlibDeprecationWarning: Since Matplotlib 3.10 indicate_inset_[zoom] returns a single InsetIndicator artist with a rectangle property and a connectors property.  From 3.12 it will no longer be possible to unpack the return value into two elements.
  _rectangle, _connectors = gs_ax2.indicate_inset_zoom(axins, edgecolor=&quot;black&quot;)
</pre></div>
</div>
<p>It can be seen that the resolution smooths over a lot of the behavious
and it can also be seen that the atmosphere has very little effect in
the CdTe energy range.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 2.204 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-atmospheric-response-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/a3cd6e01becfc088924e833aac76fcd5/plot_atmospheric_response.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_atmospheric_response.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/b91f0e447437e142e4ad1af521bb3c87/plot_atmospheric_response.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_atmospheric_response.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/80c6ecc0fd92441b35139fd1e456621f/plot_atmospheric_response.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">plot_atmospheric_response.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="plot_arf_from_scratch.html" class="btn btn-neutral float-left" title="Create an ARF from scratch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../code.html" class="btn btn-neutral float-right" title="Response-tools Code ü¶ä" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, The FOXSI Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>